<!DOCTYPE html>
<html>
<head>
    <title>Addis Bingo | Admin Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; padding: 20px; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #0088cc; color: white; }
        .status-pending { color: orange; font-weight: bold; }
        .status-approved { color: green; }
    </style>
</head>
<body>
    <h1>Addis Bingo Admin</h1>
    
    <div class="stats-grid">
        <div class="card"><h3>Total Users</h3><p id="total-users">Loading...</p></div>
        <div class="card"><h3>Total Revenue</h3><p id="total-rev">Loading...</p></div>
        <div class="card"><h3>Pending Requests</h3><p id="pending-count">Loading...</p></div>
    </div>

    <h2>Recent Requests</h2>
    <table id="requests-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>User ID</th>
                <th>Amount</th>
                <th>Type</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const supabaseUrl = 'YOUR_SUPABASE_URL';
        const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

        async function loadData() {
            // Get Stats
            const { data: users } = await _supabase.from('users').select('id', { count: 'exact' });
            const { data: rev } = await _supabase.from('history').select('amount').eq('action', 'Manual Deposit');
            const { data: reqs } = await _supabase.from('requests').select('*').order('created_at', { ascending: false });

            document.getElementById('total-users').innerText = users.length;
            document.getElementById('total-rev').innerText = rev.reduce((acc, curr) => acc + curr.amount, 0) + " ETB";
            document.getElementById('pending-count').innerText = reqs.filter(r => r.status === 'pending').length;

            const tableBody = document.querySelector('#requests-table tbody');
            tableBody.innerHTML = reqs.map(r => `
                <tr>
                    <td>${new Date(r.created_at).toLocaleDateString()}</td>
                    <td>${r.user_id}</td>
                    <td>${r.amount}</td>
                    <td>${r.type}</td>
                    <td class="status-${r.status}">${r.status}</td>
                </tr>
            `).join('');
        }

        loadData();
    </script>
</body>
</html>